\begin{frame}{Navigation Mesh}
\setbeamercovered{invisible}
\begin{minipage}{.4\textwidth}
\small Finally, navigation mesh comes to our sight.
\begin{itemize}
    \item <2->\small traversable space $=>$ convex polygons
\end{itemize}
\end{minipage}%
\begin{minipage}{.6\textwidth}
\begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
\begin{tikzpicture}
    \input{src/polyanya.tex}
    \only<1-> {\drawboundary}
    \only<1-> {\drawobstacles}
    \only<2-> {\drawmeshs}
\end{tikzpicture}
\end{adjustbox}
\end{minipage}
\end{frame}

\begin{frame}{Advantage}
\setbeamercovered{invisible}
\begin{minipage}{.5\textwidth}
\centering \small Visibility Graph
\begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
\begin{tikzpicture}
    \input{src/polyanya.tex}
    {
    \drawboundary
    \drawobstacles
    \drawVG
    }
\end{tikzpicture}
\end{adjustbox}
\end{minipage}%
\begin{minipage}{.5\textwidth}
\centering \small Navigation Mesh
\begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
\begin{tikzpicture}
    \input{src/polyanya.tex}
    {
    \drawboundary
    \drawobstacles
    \drawmeshs
    }
\end{tikzpicture}
\end{adjustbox}
\end{minipage}
\only<2>{
    \centering {
    \vfill
    We can easily preprocess the entire map!
    }
}
\only<3>{
    \centering {
    \vfill
    How to compute obstacle distance on a navigation mesh?
    }
}
\end{frame}

\begin{frame}{How to compute Obstacle Distance on Navigation Mesh?}
\setbeamercovered{invisible}
\begin{itemize}
    \item Previous works are not suitable for database scenario
    \begin{itemize}
        \item not optimal
        \item inefficient
        \item requiring costly preprocessing
    \end{itemize}
    \item \small But a recent work in 2017: \textit{Polyanya}
    \begin{itemize}
        \item fast, optimal, flexible
        \item a new direction for Obstacle kNN query
    \end{itemize}
    
\end{itemize}
\end{frame}

\begin{frame}{What's the \textit{Polyanya}?}

\begin{minipage}{.4\textwidth}
\begin{itemize}
    \item<1-> \small Given:
    \begin{itemize}
        \item \small a map with polygonal obstacles
        \item \small $q$: query point
        \item \small $t$: target
        \item \small a precomputed navigation mesh
        \item \small convex polygon: all inside points are visible
    \end{itemize}
    \item \small find the shortest path along meshes
\end{itemize}

\end{minipage}%
\begin{minipage}{.6\textwidth}
\begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
\begin{tikzpicture}
    \input{src/polyanya.tex}
    \only<1-> \drawboundary
    \only<1-> \drawobstacles
    \only<2-> \drawstart
    \only<3-> \drawend
    \only<4-> \drawmeshs
    \only<4-> \drawVs
    \only<5> \showvisible
    \only<6> \stepa
    \only<7> \stepb
\end{tikzpicture}
\end{adjustbox}
\end{minipage}
\end{frame}

\begin{frame}{Polyanya: Overview}
\textit{Polyanya} is an \textit{A*} like algorithm, it has three components
\begin{enumerate}
    \item Search Node
    \item Successors
    \item Evaluation Function
\end{enumerate}
\end{frame}

%---Search Node---
\begin{frame}{Polyanya: Search Node}

\begin{minipage}{.4\textwidth}
\begin{itemize}
    \item \small root $r$: $r \in (V \cup \{q\})$
    \item \small interval $I$: on an edge
    \item \small all points $\in I$: visible from $r$
\end{itemize}
\end{minipage}%
\begin{minipage}{.6\textwidth}
\begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
\begin{tikzpicture}
    \input{src/polyanya.tex}
    \drawmap
    \draw[green, very thick] (e)--(c);
    \nodelabel{e}{right}
    \nodelabel{c}{below}
\end{tikzpicture}
\end{adjustbox}
\end{minipage}

\end{frame}

%---Successors---
\begin{frame}{Polyanya: Successors}
    \begin{minipage}{.4\textwidth}
        \begin{itemize}
            \item \small{Successors are also search nodes}
            \item \small{Generated by pushing the parent node away to adjacent mesh.}
        \end{itemize}
    \end{minipage}%
    \begin{minipage}{.6\textwidth}
    \begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
    \begin{tikzpicture}
        \input{src/polyanya.tex}
        %\draw[black,very thick, dashed] (q)--($(q)!6cm!(e)$);
        %\draw[black,very thick, dashed] (q)--($(q)!6cm!(c)$);
        %\nodelabel{j}{below}
        \drawmap
        \fill[lightgray] (e)--(f)--(h)--(g)--(c);
        \draw[green, line width=5pt, dashed] (c)--(e);
        \draw[green, line width=3pt] (e)--(f);
        \draw[green, line width=3pt] (f)--(h);
        \draw[green, line width=3pt] (h)--(g);
        \draw[green, line width=3pt] (g)--(c);
        \drawVs
    \end{tikzpicture}
    \end{adjustbox}
    \end{minipage}
\end{frame}

\begin{frame}{Polyanya: Successors}
    \begin{minipage}{.4\textwidth}
        \begin{itemize}
            \item<1-> \small {\color{orange} Observable successors}
            \begin{itemize}
                \item<2-> \small root: parent's root
            \end{itemize}
            \item<3-> \small {\color{cyan} Non-observable successors}
            \begin{itemize}
                \item<4-> \small root: an end point of $I$
            \end{itemize}
        \end{itemize}
    \end{minipage}%
    \begin{minipage}{.6\textwidth}
    \begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
    \begin{tikzpicture}
        \input{src/polyanya.tex}
        \only<1->\drawmap
        \only<1->\fill[lightgray] (e)--(f)--(h)--(g)--(c);
        
        \only<1>\draw[green, line width=3pt] (j)--(h);
        \only<1>\draw[green, line width=3pt] (h)--(g);
        \only<1>\draw[green, line width=3pt] (g)--(c);
        
        \only<1->\draw[green, line width=5pt, dashed] (c)--(e);
        \only<1-3>\draw[green, line width=3pt] (e)--(f);
        \only<1-3>\draw[green, line width=3pt] (f)--(j);
        
        \only<2->\draw[orange!50, line width=3pt] (j)--(h);
        \only<2->\draw[orange!50, line width=3pt] (h)--(g);
        \only<2->\draw[orange!50, line width=3pt] (g)--(c);
        \only<4->\draw[cyan, line width=3pt] (e)--(f);
        \only<4->\draw[cyan, line width=3pt] (f)--(j);

        
        \only<1->\draw[black,very thin, dashed] (q)--($(q)!6cm!(e)$);
        \only<1->\draw[black,very thin, dashed] (q)--($(q)!6cm!(c)$);
        \only<1->\drawVs
        \nodelabel{j}{below}
    \end{tikzpicture}
    \end{adjustbox}
    \end{minipage}
\end{frame}

\begin{frame}{Polyanya: Evaluation Function}
\begin{minipage}{.4\textwidth}
\small Evaluation function of a search node $(r, I)$ has:
\begin{itemize}
    \item \small \textit{g-value}: $|shortestPath(q, r)|$ (certain)
    \item \small \textit{h-value}: $r$ to $t$ cross $I$ (underestimation)
    \item \small \textit{f-value}: $\textit{g-value} + \textit{h-value}$ (underestimation of $|shortestPath(q, t|$)
\end{itemize}
\end{minipage}%
\begin{minipage}{.6\textwidth}
    \begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
    \begin{tikzpicture}
        \input{src/heuristic.tex}
        \onslide<1-> \snode
        \onslide<1,3> \gvalue
        \onslide<2-> \hvalue
    \end{tikzpicture}
    \end{adjustbox}
\end{minipage}
\end{frame}

\begin{frame}{Polyanya: Example}
\begin{minipage}{.4\textwidth}
\only<1> {\small Initial Search Nodes are edges of mesh that contains the $q$.}
\only<2> {\small Search Node $(q, [e,c])$ has the best estimation, so popped out}
\only<3> {Expand successors in adjacent mesh.}
\only<4> {
\small Pop $(q, [g, h])$,\\
adjacent to obstacle,\\
so we discard it.}
\only<5> {
\small Pop $(q, [c,g])$.
}
\only<6> {
\small Expand successors.
}
\only<7> {
\small Pop $(q, [g,o])$,\\
the adjacent mesh contains $t$.\\
\large \textbf{We've found the shortest path!}
}
\end{minipage}%
\begin{minipage}{.6\textwidth}
    \begin{adjustbox}{max totalsize={.9\textwidth}{.9\textheight}, right}
    \begin{tikzpicture}
    \input{src/polyanya.tex}
    \only<1->{\drawmap}
    \only<1->{\draw[orange!50, line width=3pt] (e)--(d);}
    \only<1->{\draw[orange!50, line width=3pt] (d)--(a);}
    \only<1->{\draw[orange!50, line width=3pt] (a)--(c);}
    \only<1> {\draw[orange!50, line width=3pt] (e)--(c);}
    \only<2> {\draw[green, line width=3pt] (e)--(c);}
    \only<3-> {\draw[green, line width=5pt, dashed] (c)--(e);}
    \only<3->{\draw[black,very thin, dashed] (q)--($(q)!5cm!(e)$);}
    \only<3->{\draw[black,very thin, dashed] (q)--($(q)!5cm!(c)$);}
    \only<3->{\draw[orange!50, line width=3pt] (j)--(h);}
    \only<3>{\draw[orange!50, line width=3pt] (g)--(h);}
    \only<3,4>{\draw[orange!50, line width=3pt] (c)--(g);}
    \only<3->{\draw[cyan, line width=3pt] (e)--(f);}
    \only<3->{\draw[cyan, line width=3pt] (f)--(j);}
    \only<4-> {\draw[green, line width=3pt, dashed] (g)--(h);}
    \only<5> {\draw[green, line width=3pt] (c)--(g);}
    \only<6-> {\draw[green, line width=3pt, dashed] (c)--(g);}
    \only<6-> {\nodelabel{o}{right}}
    \only<6> {\draw[orange!50, line width=3pt] (g)--(o);}
    \only<6-> {\draw[cyan, line width=3pt] (o)--(b);}
    \only<7-> {\draw[green, line width=3pt] (g)--(o);}
    \only<7-> {\draw[red, line width=3pt] (q)--(g);}
    \only<7-> {\draw[red, line width=3pt] (g)--(t);}
    \end{tikzpicture}
    \end{adjustbox}
\end{minipage}
\end{frame}
